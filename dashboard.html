<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - DSGN LABS</title>
  <link rel="stylesheet" href="https://convert.yourdsgn.pro/dsgn-style.css">
  <style>
    body { max-width: 1100px; margin: 0 auto; padding: 24px; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif; color: #111; }
    header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .card { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 20px; margin: 12px 0; }
    .muted { color: #666; }
    .btn { display: inline-block; padding: 10px 16px; background: #667eea; color: #fff; border-radius: 8px; text-decoration: none; font-weight: 600; }
    .btn-secondary { background: #6c757d; }
    ul { padding-left: 18px; }
  </style>
  <script>
    async function load() {
      const meRes = await fetch('/api/me');
      if (meRes.status === 401) {
        document.getElementById('auth').innerHTML = '<a class="btn" href="/api/login">Login</a>';
        document.getElementById('content').innerHTML = '<p class="muted">Please login to view your projects.</p>';
        return;
      }
      const { user } = await meRes.json();
      document.getElementById('auth').innerHTML = '<span>Hi, ' + (user.name || user.email) + '</span> <a class="btn btn-secondary" href="/api/logout" style="margin-left:10px;">Logout</a>';

      const listRes = await fetch('/api/user-sessions');
      const data = await listRes.json();
      const list = data.sites || [];
      const el = document.getElementById('projects');
      if (!list.length) {
        el.innerHTML = '<p class="muted">No projects yet. Build one on the homepage and it will appear here after purchase.</p>';
        return;
      }
      el.innerHTML = '<ul>' + list.map(s => `<li><strong>${s.business_name || 'Site'}</strong> — <span class="muted">${new Date(s.created_at*1000).toLocaleString()}</span>${s.file_name ? ` — <a href="/download/${s.file_name}">Download</a>` : ''}</li>`).join('') + '</ul>';
    }
    window.addEventListener('DOMContentLoaded', load);
  </script>
</head>
<body>
  <header>
    <div><img src="/DSGN.png" alt="DSGN LABS" style="height:40px"></div>
    <div id="auth"></div>
  </header>
  <div class="card">
    <h2>My Projects</h2>
    <div id="projects"></div>
  </div>
  <div style="margin-top:12px;">
    <a href="/" class="btn">Build a New Website</a>
  </div>
</body>
</html>

